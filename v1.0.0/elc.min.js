function sort_rows(e,t,a){if(!$(t).hasClass("sort"))return!0;var l=$(e.target),r=l.data("sortkey"),i=r<0?-1*r-1:r,s=$(t).attr("data-type"),n=l.children("tbody");n.children("tr").each(function(e,t){n.children("tr").each(function(a,l){if(a==e)return!1;if(myVal=$(t).children("tr :eq("+i+")"),hisVal=$(l).children("tr :eq("+i+")"),""==myVal.html())return!1;if(""==hisVal.html())return $(t).insertBefore(l),!1;if("number"==s){if(myVal=parseFloat(myVal.html()),hisVal=parseFloat(hisVal.html()),r!=i&&myVal<hisVal||r==i&&myVal>hisVal)return $(t).insertBefore(l),!1}else if("link"==s){if(myVal=myVal.children("a:first").html(),hisVal=hisVal.children("a:first").html(),r!=i&&hisVal.localeCompare(myVal)<0||r==i&&hisVal.localeCompare(myVal)>0)return $(t).insertBefore(l),!1}else if(myVal=myVal.html(),hisVal=hisVal.html(),r!=i&&hisVal.localeCompare(myVal)<0||r==i&&hisVal.localeCompare(myVal)>0)return $(t).insertBefore(l),!1})}),l.triggerHandler("save",[a])}function update_offsets(e,t){$(e.target).children("tbody").children("tr").each(function(e,a){diff=a.offsetTopSaved-a.offsetTop,a.offsetTopSaved=a.offsetTop,t&&diff&&$(a).children().css("position","relative").css("top",diff+"px").animate({top:""})})}function apply_filter(e){var t=$(e.target),a={},l={},r={};$(".filter").each(function(t,i){if($(i).data("table"))var s=$($(i).data("table"));else s=$(i).parents(".filtered").first();if(-1!=s.index(e.target)){if($(i).data("column"))if("data:"==$(i).data("column").substr(0,5))var n=$(i).data("column");else n=$(i).data("column").toLowerCase();else n="";switch(a[n]||(a[n]=[]),l[n]||(l[n]=[]),r[n]||(r[n]=[]),$(i).attr("type")){case"checkbox":$(i).filter(":checked").length>0&&$(i).val().length>0&&l[n].push($(i).val());break;case"radio":$(i).filter(":checked").length>0&&$(i).val().length>0&&a[n].push($(i).val());break;case"number":$(i).val().length>0&&a[n].push($(i).val());break;case"text":case"":var o=$(i).val();if(o){var d=o.split(" ");for(var f in d)"+"==d[f][0]&&d[f].length>1?a[n].push(d[f].substr(1)):"|"==d[f][0]&&d[f].length>1?l[n].push(d[f].substr(1)):"-"==d[f][0]&&d[f].length>1?r[n].push(d[f].substr(1)):d[f].length>0&&a[n].push(d[f])}}}});var i=t.children("tbody").children("tr");if(i.removeClass("filtered-out"),i.each(function(e,t){for(var i in a){var s=!1;if(i)if("data:"==i.substr(0,5)){var n=$(t).data(i.substr(5));s=!0}else n=$(t).children("td, th").eq(filter_columns[i]).html().toLowerCase();else n=$(t).html().toLowerCase();var o=!0;if(a[i]&&a[i].length>0)for(var d in a[i])if(s){if(n!=a[i][d]){o=!1;break}}else try{if(-1==n.indexOf(a[i][d].toLowerCase())){o=!1;break}}catch(e){console.log(e)}var f=!0;if(l[i]&&l[i].length>0)for(var d in f=!1,l[i])if(s){if(n==l[i][d]){console.log(i+": "+f),f=!0;break}}else try{if(-1!=n.indexOf(l[i][d].toLowerCase())){f=!0;break}}catch(e){console.log(e)}var h=!0;if(r[i]&&r[i].length>0)for(var d in r[i])if(s){if(n==r[i][d]){h=!1;break}}else try{if(-1!=n.indexOf(r[i][d].toLowerCase())){h=!1;break}}catch(e){console.log(e)}if(!o||!f||!h){$(t).addClass("filtered-out");break}}}),$(".filter-list").length){for(var s in $(".filter-list").html(""),a)if(a[s].length>0)for(var n in a[s])$(".filter-list").append("<span class='filter-and' data-column='"+s+"' data-value='"+a[s][n]+"'>"+(s?s+":":"")+a[s][n]+"</span>");for(var s in l)if(l[s].length>0)for(var n in l[s])$(".filter-list").append("<span class='filter-or' data-column='"+s+"' data-value='"+l[s][n]+"'>"+(s?s+":":"")+l[s][n]+"</span>");for(var s in r)if(r[s].length>0)for(var n in r[s])$(".filter-list").append("<span class='filter-not' data-column='"+s+"' data-value='"+r[s][n]+"'>"+(s?s+":":"")+r[s][n]+"</span>");$(".filter-list *").click(remove_filter)}}var filter_delay=setTimeout(function(){},1);function filter_changed(e){if(clearTimeout(filter_delay),$(this).data("table"))var t=$($(this).data("table"));else t=$(this).parents(".filtered").first();if(0==t.length)return console.log("Cannot find the table this filter is meant to apply to: "+$(this)),!1;"keyup"==e.type?filter_delay=setTimeout(function(e){e.triggerHandler("update")},250,t):t.triggerHandler("update")}function remove_filter(e){console.log($(this).parentsUntil(".filter-list"))}function display_page(e){var t=$(e.target),a=t.data("page"),l=t.data("perpage"),r=t.children("tbody").children("tr").not(".filtered-out");a<=0?(t.find(".pageup").removeClass("active"),a=0,t.data("page",a)):t.find(".pageup").addClass("active"),a+1>=r.length/l?(t.find(".pagedown").removeClass("active"),a=Math.ceil(r.length/l)-1,t.data("page",a)):t.find(".pagedown").addClass("active");var i=!1;r.removeClass("paged-out odd even").each(function(e,t){e<a*l||e>=(a+1)*l?$(t).addClass("paged-out"):($(t).addClass(i?"even":"odd"),i=!i)}),t.find(".page").html("Page "+(a+1)+" of "+Math.ceil(r.length/l))}var filter_columns={};$(function(){$(".sortable").bind("update",sort_rows).bind("save",update_offsets).css("position","relative");var e=$(".sortable thead .sorter th:first, .sortable thead .sorter td:first");0==e.length&&(e=$(".sortable thead tr:first th:first, .sortable thead tr:first td:first")),e.each(function(e){for(cell=$(this),offset=0;cell.length;)cell.prop("sortIndex",cell.prop("cellIndex")+offset),offset+=cell.prop("colSpan")-1,cell=cell.next()}),$(".sortable thead .sort").click(function(e){var t=null!=this.sortIndex?this.sortIndex:this.cellIndex,a=$(this).parents("table.sortable").first();$(this).siblings().addBack().removeClass("sortup sortdown"),a.data("sortkey")==t?($(this).addClass("sortup"),a.data("sortkey",-1*t-1)):($(this).addClass("sortdown"),a.data("sortkey",t)),a.prop("lastClick",e),a.triggerHandler("update",[this,a.hasClass("sort-animated")])}),$(".filtered").bind("update",apply_filter),$(".filter").keyup(filter_changed).change(filter_changed).keyup(),$(".filtered thead .filterable").each(function(e,t){$(t).data("column")?filter_columns[$(t).data("column").toLowerCase()]=t.cellIndex:filter_columns[$(t).html().toLowerCase()]=t.cellIndex}),$(".paged").bind("update",display_page).data("page",0),$(".paged .pageup").click(function(e){var t=$(this).parents("table").first();if(0==t.data("page"))return!1;t.data("page",t.data("page")-1),t.triggerHandler("update")}),$(".paged .pagedown").click(function(e){var t=$(this).parents("table").first();if(t.data("page")+1>=t.children("tbody").children("tr").length/t.data("perpage"))return!1;t.data("page",t.data("page")+1),t.triggerHandler("update")}),$(".paged .perpage").change(function(e){var t=$(this).parents("table").first(),a=parseInt($(this).val());a?t.data("perpage",a):(t.data("perpage",20),$(this).val(20)),t.triggerHandler("update")}).change()});